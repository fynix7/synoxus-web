---
description: Setup Supabase for Cloud Storage and Realtime Database
---

# Supabase Setup Guide

To make your application "live" with real cloud storage and a working CRM/Chat, we will use **Supabase**. Follow these steps to set up your project.

## 1. Create a Supabase Project
1.  Go to [https://supabase.com/](https://supabase.com/) and sign up/log in.
2.  Click **"New Project"**.
3.  Choose your organization, give your project a name (e.g., `Synoxus Web`), and set a database password.
4.  Choose a region close to your users (e.g., US West).
5.  Click **"Create new project"**.

## 2. Get API Keys
1.  Once your project is ready (it takes a minute), go to **Project Settings** (gear icon at the bottom left).
2.  Click on **API**.
3.  Copy the **Project URL** and the **anon public** key.

## 3. Connect Your App
1.  In your project root, create a file named `.env` (if it doesn't exist).
2.  Add the following lines, replacing the placeholders with your actual keys:

```env
VITE_SUPABASE_URL=your_project_url_here
VITE_SUPABASE_ANON_KEY=your_anon_key_here
```

## 4. Create Database Tables
Go to the **SQL Editor** (icon on the left sidebar) in Supabase, click **"New Query"**, paste the following SQL, and click **Run**. This will set up your tables for Chat and CRM.

```sql
-- Enable Row Level Security
alter default privileges revoke execute on functions from public;

-- 1. CHAT MESSAGES TABLE
create table public.messages (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  text text not null,
  sender text not null, -- 'user' or 'agent'
  session_id uuid not null -- to group messages by user session
);

-- 2. CRM TASKS TABLE
create table public.crm_tasks (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  title text not null,
  description text,
  status text not null default 'todo', -- Now links to crm_columns.id or title
  priority text default 'medium',
  due_date timestamp with time zone,
  created_by text,
  metadata jsonb default '{}'::jsonb -- For subtasks, custom tags, comments
);

-- 3. CRM COLUMNS TABLE (New for Dynamic Board)
create table public.crm_columns (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  title text not null,
  position integer not null,
  client_id text -- To separate boards if needed
);

-- Insert default columns
insert into public.crm_columns (title, position) values 
('To Do', 0),
('In Progress', 1),
('Done', 2);

-- 4. CRM ACCESS KEYS
create table public.access_keys (
  id bigint generated by default as identity primary key,
  key_value text not null unique,
  role text not null, -- 'master_admin', 'admin', 'employee'
  client_id text
);

-- Insert default keys
insert into public.access_keys (key_value, role) values 
('synoxus2004', 'master_admin'),
('admin', 'admin'),
('synoxus', 'employee');

-- ENABLE RLS
alter table public.messages enable row level security;
create policy "Allow public read/write messages" on public.messages for all using (true) with check (true);

alter table public.crm_tasks enable row level security;
create policy "Allow public read/write tasks" on public.crm_tasks for all using (true) with check (true);

alter table public.crm_columns enable row level security;
create policy "Allow public read/write columns" on public.crm_columns for all using (true) with check (true);

alter table public.access_keys enable row level security;
create policy "Allow public read keys" on public.access_keys for select using (true);
```

## 5. Deploying to Vercel (for "Live" site)
1.  Push your code to a GitHub repository.
2.  Go to [https://vercel.com/](https://vercel.com/) and import your repo.
3.  In the Vercel project settings, go to **Environment Variables**.
4.  Add `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY` with the same values as your local `.env`.
5.  Deploy!
